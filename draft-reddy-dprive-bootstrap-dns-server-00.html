<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Bootstrapping to discover and authenticate DNS-over-(D)TLS and DNS-over-HTTPS servers</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Bootstrapping IoT devices and broadband gateways">
<link href="#rfc.section.3" rel="Chapter" title="3 Bootstrapping endpoint devices">
<link href="#rfc.section.4" rel="Chapter" title="4 Discovery procedure">
<link href="#rfc.section.5" rel="Chapter" title="5 DHCP Options for DNS server discovery">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 DHCPv6 DNS Options">
<link href="#rfc.section.5.1.1" rel="Chapter" title="5.1.1 Format of DNS Reference Identifier Option">
<link href="#rfc.section.5.1.2" rel="Chapter" title="5.1.2 DHCPv6 Client Behavior">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 DHCPv4 DNS Options">
<link href="#rfc.section.5.2.1" rel="Chapter" title="5.2.1 Format of DNS Reference Identifier Option">
<link href="#rfc.section.5.2.2" rel="Chapter" title="5.2.2 DHCPv4 Client Behavior">
<link href="#rfc.section.6" rel="Chapter" title="6 Resolution">
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations">
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 DHCPv6 Option">
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 DHCPv4 Option">
<link href="#rfc.section.8.3" rel="Chapter" title="8.3 Application Service &amp; Application Protocol Tags">
<link href="#rfc.section.8.3.1" rel="Chapter" title="8.3.1 DNS Application Service Tag Registration">
<link href="#rfc.section.8.3.2" rel="Chapter" title="8.3.2 dns.tls Application Protocol Tag Registration">
<link href="#rfc.section.8.3.3" rel="Chapter" title="8.3.3 dns.dtls Application Protocol Tag Registration">
<link href="#rfc.section.8.3.4" rel="Chapter" title="8.3.4 dns.https Application Protocol Tag Registration">
<link href="#rfc.references" rel="Chapter" title="9 References">
<link href="#rfc.references.1" rel="Chapter" title="9.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="9.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.19.1 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Reddy, T., Wing, D., and M. Richardson" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-reddy-dprive-bootstrap-dns-server-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2019-02-21" />
  <meta name="dct.abstract" content="This document explains mechanisms to automatically bootstrap endpoints to discover and authenticate DNS-over-(D)TLS and DNS-over-HTTPS servers provided by the local network." />
  <meta name="description" content="This document explains mechanisms to automatically bootstrap endpoints to discover and authenticate DNS-over-(D)TLS and DNS-over-HTTPS servers provided by the local network." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">DPRIVE WG</td>
<td class="right">T. Reddy</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">McAfee</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">D. Wing</td>
</tr>
<tr>
<td class="left">Expires: August 25, 2019</td>
<td class="right"></td>
</tr>
<tr>
<td class="left"></td>
<td class="right">M. Richardson</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Sandelman Software Works</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">February 21, 2019</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Bootstrapping to discover and authenticate DNS-over-(D)TLS and DNS-over-HTTPS servers<br />
  <span class="filename">draft-reddy-dprive-bootstrap-dns-server-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document explains mechanisms to automatically bootstrap endpoints to discover and authenticate DNS-over-(D)TLS and DNS-over-HTTPS servers provided by the local network.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on August 25, 2019.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2019 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Bootstrapping IoT devices and broadband gateways</a>
</li>
<li>3.   <a href="#rfc.section.3">Bootstrapping endpoint devices</a>
</li>
<li>4.   <a href="#rfc.section.4">Discovery procedure</a>
</li>
<li>5.   <a href="#rfc.section.5">DHCP Options for DNS server discovery</a>
</li>
<ul><li>5.1.   <a href="#rfc.section.5.1">DHCPv6 DNS Options</a>
</li>
<ul><li>5.1.1.   <a href="#rfc.section.5.1.1">Format of DNS Reference Identifier Option</a>
</li>
<li>5.1.2.   <a href="#rfc.section.5.1.2">DHCPv6 Client Behavior</a>
</li>
</ul><li>5.2.   <a href="#rfc.section.5.2">DHCPv4 DNS Options</a>
</li>
<ul><li>5.2.1.   <a href="#rfc.section.5.2.1">Format of DNS Reference Identifier Option</a>
</li>
<li>5.2.2.   <a href="#rfc.section.5.2.2">DHCPv4 Client Behavior</a>
</li>
</ul></ul><li>6.   <a href="#rfc.section.6">Resolution</a>
</li>
<li>7.   <a href="#rfc.section.7">Security Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">IANA Considerations</a>
</li>
<ul><li>8.1.   <a href="#rfc.section.8.1">DHCPv6 Option</a>
</li>
<li>8.2.   <a href="#rfc.section.8.2">DHCPv4 Option</a>
</li>
<li>8.3.   <a href="#rfc.section.8.3">Application Service &amp; Application Protocol Tags</a>
</li>
<ul><li>8.3.1.   <a href="#rfc.section.8.3.1">DNS Application Service Tag Registration</a>
</li>
<li>8.3.2.   <a href="#rfc.section.8.3.2">dns.tls Application Protocol Tag Registration</a>
</li>
<li>8.3.3.   <a href="#rfc.section.8.3.3">dns.dtls Application Protocol Tag Registration</a>
</li>
<li>8.3.4.   <a href="#rfc.section.8.3.4">dns.https Application Protocol Tag Registration</a>
</li>
</ul></ul><li>9.   <a href="#rfc.references">References</a>
</li>
<ul><li>9.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>9.2.   <a href="#rfc.references.2">Informative References</a>
</li>
</ul><li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">Various network security services are provided by Enterprise, secure home and wall-gardened networks to protect endpoints, some of these security services act on DNS requests from endpoints. However, if the endpoints are configured to use public DNS-over-(D)TLS <a href="#RFC7858" class="xref">[RFC7858]</a> <a href="#RFC8094" class="xref">[RFC8094]</a> or DNS-over-HTTPS <a href="#RFC8484" class="xref">[RFC8484]</a> servers, network security services in the local network cannot act on DNS requests from the endpoints. In order to act on DNS requests from endpoints, network security services can block DNS-over-(D)TLS traffic by dropping outgoing packets to destination port 853, and by identifying the domains offering DNS-over-HTTPS servers, DNS-over-HTTPS traffic can be blocked by dropping outgoing packets to these domains. If the endpoint has enabled strict privacy profile (Section 5 of <a href="#RFC8310" class="xref">[RFC8310]</a>), and the network security service blocks the traffic to the public DNS server, DNS service is not available to the endpoint and ultimately the endpoint cannot access Internet. If the endpoint has enabled opportunistic privacy profile (Section 5 of <a href="#RFC8310" class="xref">[RFC8310]</a>), and the network security service blocks traffic to the public DNS server, the endpoint will either fallback to an encrypted connection without authenticating the DNS-over-(D)TLS and DNS-over-HTTPS servers provided by the local network or fallback to clear text DNS, and cannot exchange encrypted DNS messages. This can compromise the endpoint security and privacy, some of the possible security threats are listed below:</p>
<p></p>

<ul>
<li>Pervasive monitoring of DNS traffic.</li>
<li>If IoT devices are configured to use public DNS-over-(D)TLS or DNS-over-HTTPS servers, and if a policy enforcement point in the local network is programmed using a Manufacturer Usage Description (MUD) file <a href="#I-D.ietf-opsawg-mud" class="xref">[I-D.ietf-opsawg-mud]</a> by the MUD manager to only allow intented communications to and from the IoT devices, the policy enforcement point cannot enforce the Network Access Control List rules based on domain names (Section 8 of <a href="#I-D.ietf-opsawg-mud" class="xref">[I-D.ietf-opsawg-mud]</a>).</li>
<li>The network security service cannot block the endpoint from accessing malicious domains. Attacks like DNS cache poisoning can lead the user to visit malicious website to inject malware on the endpoint. For instance, malwares like DNSChanger can modify the endpoint's DNS entries to point toward its own rogue name servers which then injected its own advertising into Web pages.</li>
</ul>
<p id="rfc.section.1.p.3">The working groups DPRIVE and DoH have not defined a automated mechanism to securely bootstrap the endpoints to discover and authenticate DNS-over-(D)TLS and DNS-over-HTTPS servers in the local network. Some clients have hard-coded specific public DNS servers (such as Mozilla using Cloudflare's DNS-over-HTTPS server). If endpoints continue to use hard-coded public DNS servers, this has a risk of relying on few centralized DNS services. Further, Content Delivery Networks (CDNs) that map traffic based on DNS may lose the ability to direct end-user traffic to a nearby cluster in cases where a DNS service is being used that is not affiliated with the local network and which does not send "EDNS Client Subnet" (ECS) information to the CDN's DNS authorities <a href="#CDN" class="xref">[CDN]</a>.</p>
<p id="rfc.section.1.p.4">The draft proposes a mechanism to automatically bootstrap the endpoints to discover and authenticate the DNS-over-(D)TLS and DNS-over-HTTPS servers provided by the local network.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#bootstrap-iot" id="bootstrap-iot">Bootstrapping IoT devices and broadband gateways</a>
</h1>
<p id="rfc.section.2.p.1">The following steps discuss the mechanism to automatically bootstrap IoT devices with local network's CA certificates and DNS server certificate. The above steps can also be used by broadband gateways acting as DNS forwarders to discover and authenticate DNS-over-(D)TLS and DNS-over-HTTPS servers provided by the access networks.</p>

<ul><li>The IoT device can use Bootstrapping Remote Secure Key Infrastructures (BRSKI) discussed in <a href="#I-D.ietf-anima-bootstrapping-keyinfra" class="xref">[I-D.ietf-anima-bootstrapping-keyinfra]</a> to automatically bootstrap the IoT device using the IoT manufacturer provisioned X.509 certificate, in combination with a registrar provided by the local network and IoT device manufacturer's authorizing service (MASA). <ol>
<li>The IoT device authenticates to the local network using the IoT manufacturer provisioned X.509 certificate. The IoT device can request and get a voucher from the MASA service via the registrar. The voucher is signed by the MASA service and includes the local network's CA public key.</li>
<li>The IoT device validates the signed voucher using the manufacturer installed trust anchor associated with the MASA, stores the CA's public key and validates the provisional TLS connection to the registrar.</li>
<li>The IoT device requests the full Enrollment over Secure Transport (EST) <a href="#RFC7030" class="xref">[RFC7030]</a> distribution of current CA certificates (Section 5.9.1 in <a href="#I-D.ietf-anima-bootstrapping-keyinfra" class="xref">[I-D.ietf-anima-bootstrapping-keyinfra]</a>) from the registrar operating as a BRSKI-EST server. The IoT device uses the Explicit Trust Anchor database to validate the DNS server certificate.</li>
<li>TBD: The IoT device learns the End-Entity certificates <a href="#RFC8295" class="xref">[RFC8295]</a> from the BRSKI-EST server. The certificate provisioned to the DNS server in the local network will be treated as a End-Entity certificate. The IoT device needs to identify the End-Entity certificate is provisioned to the DNS server, the key usage extension <a href="#RFC5280" class="xref">[RFC5280]</a> can be used to restrict the use of the End-Entity certificate to authenticate the DNS server, a new bit will be added to the KeyUsage type to identify the DNS server certificate.</li>
</ol>
</li></ul>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#bootstrap-endpoint" id="bootstrap-endpoint">Bootstrapping endpoint devices</a>
</h1>
<p id="rfc.section.3.p.1">The following steps explain the mechanism to automatically bootstrap endpoint with the local network's CA certificates and DNS server certificate. </p>

<ol>
<li>The endpoint authenticates to the local network and establishes provisional TLS connection with the registrar operating as the BRSKI-EST server. The endpoint discovers registrar using DNS-based Service Discovery <a href="#RFC6763" class="xref">[RFC6763]</a>.</li>
<li>The endpoint uses Salted Challenge Response Authentication Mechanism (SCRAM) <a href="#RFC7804" class="xref">[RFC7804]</a> to perform mutual authentication with the discovered BRSKI-EST server.</li>
<li>If the BRSKI-EST server authentication is successful, the endpoint requests the full EST distribution of current CA certificates and validates the provisional TLS connection to the BRSKI-EST server. If the BRSKI-EST server certificate cannot be verified using the CA certifates downloaded, the TLS connection is immediately discarded and the endpoint abandons the attempt to bootstrap from the BRSKI-EST server and discards the CA certificates conveyed by the BRSKI-EST server. The endpoint uses the Explicit Trust Anchor database to validate the DNS server certificate.</li>
<li>TBD: The endpoint learns the End-Entity certificates <a href="#RFC8295" class="xref">[RFC8295]</a> from the BRSKI-EST server. The certificate provisioned to the DNS server in the local network will be treated as a End-Entity certificate. The endpoint needs to identify the End-Entity certificate is provisioned to the DNS server, the key usage extension <a href="#RFC5280" class="xref">[RFC5280]</a> can be used to restrict the use of the End-Entity certificate to authenticate the DNS server, a new bit will be added to the KeyUsage type to identify the DNS server certificate.</li>
</ol>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#discovery" id="discovery">Discovery procedure</a>
</h1>
<p id="rfc.section.4.p.1">A DNS client can discover the DNS server in the local network supporting DNS-over-TLS, DNS-over-DTLS and DNS-over-HTTPS protocols by using the following discovery mechanism:</p>
<p></p>

<ul>
<li>The DNS client uses DHCP to discover the authentication domain name for the DNS server, as specified in <a href="#dhcp" class="xref">Section 5</a>.</li>
<li>The DNS client then use S-NAPTR <a href="#RFC3958" class="xref">[RFC3958]</a> lookup to learn the protocols DNS-over-TLS, DNS-over-DTLS and DNS-over-HTTPS supported by the DNS server and the DNS privacy protocol preferred by the DNS server administrators, as specified in <a href="#serviceT" class="xref">Section 8.3.1</a>.</li>
<li>The DNS client initiates (D)TLS handshake with the DNS server, the server present its certificate and the client validates the server certificate using the End-Entity certificate and Explicit Trust Anchor database downloaded in steps 3 and 4 in <a href="#bootstrap-iot" class="xref">Section 2</a>.</li>
</ul>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#dhcp" id="dhcp">DHCP Options for DNS server discovery</a>
</h1>
<p id="rfc.section.5.p.1">As reported in Section 1.7.2 of <a href="#RFC6125" class="xref">[RFC6125]</a>:</p>

<ul class="empty"><li>"few certification authorities issue server certificates based on IP addresses, but preliminary evidence indicates that such certificates are a very small percentage (less than 1%) of issued certificates".</li></ul>
<p id="rfc.section.5.p.2">In order to allow for certifcate authentication between a DNS client and server while accommodating for the current best practices for issuing certificates, this document allows for configuring authentication domain name to clients. This name can be used as a reference identifier for authentication purposes.</p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> DHCPv6 DNS Options</h1>
<h1 id="rfc.section.5.1.1">
<a href="#rfc.section.5.1.1">5.1.1.</a> Format of DNS Reference Identifier Option</h1>
<p id="rfc.section.5.1.1.p.1">The DHCPv6 DNS option is used to configure a authentication domain name. The format of this option is shown in <a href="#ri_option1" class="xref">Figure 1</a>.</p>
<div id="rfc.figure.1"></div>
<div id="ri_option1"></div>
<pre>    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     OPTION_V6_AUTH_DOMAIN     |         Option-length         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |            authentication-domain-name (FQDN)                  |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre>
<p class="figure">Figure 1: DHCPv6 DNS Reference Identifier option</p>
<p><a href="#ri_option1" class="xref">Figure 1</a> are as follows:</p>
<p></p>

<ul>
<li>Option-code: OPTION_V6_AUTH_DOMAIN (TBA1, see <a href="#iana6" class="xref">Section 8.1</a>)</li>
<li>Option-length: Length of the authentication-domain-name field in octets.</li>
<li>authentication-domain-name: A fully qualified domain name of the DNS server. This field is formatted as specified in Section 8 of <a href="#RFC3315" class="xref">[RFC3315]</a>.</li>
</ul>
<h1 id="rfc.section.5.1.2">
<a href="#rfc.section.5.1.2">5.1.2.</a> DHCPv6 Client Behavior</h1>
<p id="rfc.section.5.1.2.p.1">DHCP clients MAY request options OPTION_V6_AUTH_DOMAIN as defined in <a href="#RFC3315" class="xref">[RFC3315]</a>, Sections 17.1.1, 18.1.1, 18.1.3, 18.1.4, 18.1.5, and 22.7. As a convenience to the reader, it is mentioned here that the DHCP client includes the requested option code in the Option Request Option.</p>
<p id="rfc.section.5.1.2.p.2">If the DHCP client receives more than one instance of OPTION_V6_AUTH_DOMAIN option, it MUST use only the first instance of that option.</p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> DHCPv4 DNS Options</h1>
<h1 id="rfc.section.5.2.1">
<a href="#rfc.section.5.2.1">5.2.1.</a> Format of DNS Reference Identifier Option</h1>
<p id="rfc.section.5.2.1.p.1">The DHCPv4 DNS option is used to configure a authentication domain name. The format of this option is illustrated in <a href="#dhcpri_dots" class="xref">Figure 2</a>.</p>
<div id="rfc.figure.2"></div>
<div id="dhcpri_dots"></div>
<pre>
          Code  Length   authentication domain name
         +-----+-----+-----+-----+-----+-----+-----+--
         |TBA2 |  n  |  s1 |  s2 |  s3 |  s4 | s5  |  ...
         +-----+-----+-----+-----+-----+-----+-----+--

   The values s1, s2, s3, etc. represent the domain name labels in the
   domain name encoding.

</pre>
<p class="figure">Figure 2: DHCPv4 DNS Reference Identifier option</p>
<p></p>
<p id="rfc.section.5.2.1.p.3">The fields of the option shown in <a href="#dhcpri_dots" class="xref">Figure 2</a> are as follows:</p>

<ul>
<li>Code: OPTION_V4_AUTH_DOMAIN (TBA2, see <a href="#iana4" class="xref">Section 8.2</a>);</li>
<li>Length: Includes the length of the authentication domain name field in octets; the maximum length is 255 octets.</li>
<li>Authentication domain name: The domain name of the DNS server. This field is formatted as specified in Section 8 of <a href="#RFC3315" class="xref">[RFC3315]</a>.</li>
</ul>
<h1 id="rfc.section.5.2.2">
<a href="#rfc.section.5.2.2">5.2.2.</a> DHCPv4 Client Behavior</h1>
<p id="rfc.section.5.2.2.p.1">To discover a authentication domain name, the DHCPv4 client MUST include OPTION_V4_AUTH_DOMAIN in a Parameter Request List Option <a href="#RFC2132" class="xref">[RFC2132]</a>.</p>
<p id="rfc.section.5.2.2.p.2">If the DHCP client receives more than one instance of OPTION_V4_AUTH_DOMAIN option, it MUST use only the first instance of that option. The content of OPTION_V4_AUTH_DOMAIN is used as reference identifier for authentication purposes.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#srvr" id="srvr">Resolution</a>
</h1>
<p id="rfc.section.6.p.1">Once the DNS client has retrieved the authentication domain name for the DNS server, an S-NAPTR lookup with 'DPRIVE' application service and the desired protocol tag is made to obtain information necessary to securely connect to the DNS server.</p>
<p id="rfc.section.6.p.2">This specification defines "DPRIVE" as an application service tag (<a href="#serviceT" class="xref">Section 8.3.1</a>) and "dns.tls" (<a href="#dnstls" class="xref">Section 8.3.2</a>), "dns.dtls" (<a href="#dnsdtls" class="xref">Section 8.3.3</a>), and "dns.https" (<a href="#dnshttps" class="xref">Section 8.3.4</a>) as application protocol tags.</p>
<p id="rfc.section.6.p.3">If no DNS-specific S-NAPTR records can be retrieved, the discovery procedure fails for this authentication domain name. However, before retrying a lookup that has failed, a DNS client MUST wait a time period that is appropriate for the encountered error (e.g., NXDOMAIN, timeout, etc.).</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.7.p.1">The primary attack against the methods described in <a href="#discovery" class="xref">Section 4</a> is one that would lead to impersonation of a DNS server. An attacker could attempt to compromise the DHCP discovery and S-NAPTR resolution. The attack is prevented by validating the certificate presented by the DNS server.</p>
<p id="rfc.section.7.p.2">Security considerations in <a href="#I-D.ietf-anima-bootstrapping-keyinfra" class="xref">[I-D.ietf-anima-bootstrapping-keyinfra]</a> and <a href="#RFC7804" class="xref">[RFC7804]</a> need to be taken into consideration.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<h1 id="rfc.section.8.1">
<a href="#rfc.section.8.1">8.1.</a> <a href="#iana6" id="iana6">DHCPv6 Option</a>
</h1>
<p id="rfc.section.8.1.p.1">IANA is requested to assign the following new DHCPv6 Option Code in the registry maintained in http://www.iana.org/assignments/dhcpv6-parameters:</p>
<table cellpadding="3" cellspacing="0" class="tt headers center">
<thead><tr>
<th class="right">Option Name</th>
<th class="left">Value</th>
</tr></thead>
<tbody><tr>
<td class="right">OPTION_V6_AUTH_DOMAIN</td>
<td class="left">TBA1</td>
</tr></tbody>
</table>
<h1 id="rfc.section.8.2">
<a href="#rfc.section.8.2">8.2.</a> <a href="#iana4" id="iana4">DHCPv4 Option</a>
</h1>
<p id="rfc.section.8.2.p.1">IANA is requested to assign the following new DHCPv4 Option Code in the registry maintained in http://www.iana.org/assignments/bootp-dhcp-parameters/:</p>
<table cellpadding="3" cellspacing="0" class="tt headers center">
<thead><tr>
<th class="right">Option Name</th>
<th class="left">Value</th>
<th class="left">Data length</th>
<th class="left">Meaning</th>
</tr></thead>
<tbody><tr>
<td class="right">OPTION_V4_AUTH_DOMAIN</td>
<td class="left">TBA2</td>
<td class="left">Variable; the maximum length is 255 octets.</td>
<td class="left">Includes the authentication domain name.</td>
</tr></tbody>
</table>
<h1 id="rfc.section.8.3">
<a href="#rfc.section.8.3">8.3.</a> Application Service &amp; Application Protocol Tags</h1>
<p id="rfc.section.8.3.p.1">This document requests IANA to make the following allocations from the registry available at: https://www.iana.org/assignments/s-naptr-parameters/s-naptr-parameters.xhtml.</p>
<h1 id="rfc.section.8.3.1">
<a href="#rfc.section.8.3.1">8.3.1.</a> <a href="#serviceT" id="serviceT">DNS Application Service Tag Registration</a>
</h1>
<p></p>

<ul>
<li>Application Protocol Tag: DPRIVE</li>
<li>Intended Usage: See <a href="#srvr" class="xref">Section 6</a>
</li>
<li>Security Considerations: See <a href="#Security" class="xref">Section 7</a>
</li>
<li>Contact Information: &lt;one of the authors&gt;</li>
</ul>
<h1 id="rfc.section.8.3.2">
<a href="#rfc.section.8.3.2">8.3.2.</a> <a href="#dnstls" id="dnstls">dns.tls Application Protocol Tag Registration</a>
</h1>
<p></p>

<ul>
<li>Application Protocol Tag: dns.tls</li>
<li>Intended Usage: See <a href="#srvr" class="xref">Section 6</a>
</li>
<li>Security Considerations: See <a href="#Security" class="xref">Section 7</a>
</li>
<li>Contact Information: &lt;one of the authors&gt;</li>
</ul>
<h1 id="rfc.section.8.3.3">
<a href="#rfc.section.8.3.3">8.3.3.</a> <a href="#dnsdtls" id="dnsdtls">dns.dtls Application Protocol Tag Registration</a>
</h1>
<p></p>

<ul>
<li>Application Protocol Tag: dns.dtls</li>
<li>Intended Usage: See <a href="#srvr" class="xref">Section 6</a>
</li>
<li>Security Considerations: See <a href="#Security" class="xref">Section 7</a>
</li>
<li>Contact Information: &lt;one of the authors&gt;</li>
</ul>
<h1 id="rfc.section.8.3.4">
<a href="#rfc.section.8.3.4">8.3.4.</a> <a href="#dnshttps" id="dnshttps">dns.https Application Protocol Tag Registration</a>
</h1>
<p></p>

<ul>
<li>Application Protocol Tag: dnshttps</li>
<li>Intended Usage: See <a href="#srvr" class="xref">Section 6</a>
</li>
<li>Security Considerations: See <a href="#Security" class="xref">Section 7</a>
</li>
<li>Contact Information: &lt;one of the authors&gt;</li>
</ul>
<h1 id="rfc.references">
<a href="#rfc.references">9.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">9.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.ietf-anima-bootstrapping-keyinfra">[I-D.ietf-anima-bootstrapping-keyinfra]</b></td>
<td class="top">
<a>Pritikin, M.</a>, <a>Richardson, M.</a>, <a>Behringer, M.</a>, <a>Bjarnason, S.</a> and <a>K. Watsen</a>, "<a href="https://tools.ietf.org/html/draft-ietf-anima-bootstrapping-keyinfra-18">Bootstrapping Remote Secure Key Infrastructures (BRSKI)</a>", Internet-Draft draft-ietf-anima-bootstrapping-keyinfra-18, January 2019.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2132">[RFC2132]</b></td>
<td class="top">
<a>Alexander, S.</a> and <a>R. Droms</a>, "<a href="https://tools.ietf.org/html/rfc2132">DHCP Options and BOOTP Vendor Extensions</a>", RFC 2132, DOI 10.17487/RFC2132, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3315">[RFC3315]</b></td>
<td class="top">
<a>Droms, R.</a>, <a>Bound, J.</a>, <a>Volz, B.</a>, <a>Lemon, T.</a>, <a>Perkins, C.</a> and <a>M. Carney</a>, "<a href="https://tools.ietf.org/html/rfc3315">Dynamic Host Configuration Protocol for IPv6 (DHCPv6)</a>", RFC 3315, DOI 10.17487/RFC3315, July 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3958">[RFC3958]</b></td>
<td class="top">
<a>Daigle, L.</a> and <a>A. Newton</a>, "<a href="https://tools.ietf.org/html/rfc3958">Domain-Based Application Service Location Using SRV RRs and the Dynamic Delegation Discovery Service (DDDS)</a>", RFC 3958, DOI 10.17487/RFC3958, January 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5280">[RFC5280]</b></td>
<td class="top">
<a>Cooper, D.</a>, <a>Santesson, S.</a>, <a>Farrell, S.</a>, <a>Boeyen, S.</a>, <a>Housley, R.</a> and <a>W. Polk</a>, "<a href="https://tools.ietf.org/html/rfc5280">Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>", RFC 5280, DOI 10.17487/RFC5280, May 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6125">[RFC6125]</b></td>
<td class="top">
<a>Saint-Andre, P.</a> and <a>J. Hodges</a>, "<a href="https://tools.ietf.org/html/rfc6125">Representation and Verification of Domain-Based Application Service Identity within Internet Public Key Infrastructure Using X.509 (PKIX) Certificates in the Context of Transport Layer Security (TLS)</a>", RFC 6125, DOI 10.17487/RFC6125, March 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6763">[RFC6763]</b></td>
<td class="top">
<a>Cheshire, S.</a> and <a>M. Krochmal</a>, "<a href="https://tools.ietf.org/html/rfc6763">DNS-Based Service Discovery</a>", RFC 6763, DOI 10.17487/RFC6763, February 2013.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7030">[RFC7030]</b></td>
<td class="top">
<a>Pritikin, M.</a>, <a>Yee, P.</a> and <a>D. Harkins</a>, "<a href="https://tools.ietf.org/html/rfc7030">Enrollment over Secure Transport</a>", RFC 7030, DOI 10.17487/RFC7030, October 2013.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7804">[RFC7804]</b></td>
<td class="top">
<a>Melnikov, A.</a>, "<a href="https://tools.ietf.org/html/rfc7804">Salted Challenge Response HTTP Authentication Mechanism</a>", RFC 7804, DOI 10.17487/RFC7804, March 2016.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7858">[RFC7858]</b></td>
<td class="top">
<a>Hu, Z.</a>, <a>Zhu, L.</a>, <a>Heidemann, J.</a>, <a>Mankin, A.</a>, <a>Wessels, D.</a> and <a>P. Hoffman</a>, "<a href="https://tools.ietf.org/html/rfc7858">Specification for DNS over Transport Layer Security (TLS)</a>", RFC 7858, DOI 10.17487/RFC7858, May 2016.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8094">[RFC8094]</b></td>
<td class="top">
<a>Reddy, T.</a>, <a>Wing, D.</a> and <a>P. Patil</a>, "<a href="https://tools.ietf.org/html/rfc8094">DNS over Datagram Transport Layer Security (DTLS)</a>", RFC 8094, DOI 10.17487/RFC8094, February 2017.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8295">[RFC8295]</b></td>
<td class="top">
<a>Turner, S.</a>, "<a href="https://tools.ietf.org/html/rfc8295">EST (Enrollment over Secure Transport) Extensions</a>", RFC 8295, DOI 10.17487/RFC8295, January 2018.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8484">[RFC8484]</b></td>
<td class="top">
<a>Hoffman, P.</a> and <a>P. McManus</a>, "<a href="https://tools.ietf.org/html/rfc8484">DNS Queries over HTTPS (DoH)</a>", RFC 8484, DOI 10.17487/RFC8484, October 2018.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">9.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="CDN">[CDN]</b></td>
<td class="top">"<a href="https://conferences.sigcomm.org/sigcomm/2015/pdf/papers/p167.pdf">End-User Mapping: Next Generation Request Routing for Content Delivery</a>", 2015.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-opsawg-mud">[I-D.ietf-opsawg-mud]</b></td>
<td class="top">
<a>Lear, E.</a>, <a>Droms, R.</a> and <a>D. Romascanu</a>, "<a href="https://tools.ietf.org/html/draft-ietf-opsawg-mud-25">Manufacturer Usage Description Specification</a>", Internet-Draft draft-ietf-opsawg-mud-25, June 2018.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8310">[RFC8310]</b></td>
<td class="top">
<a>Dickinson, S.</a>, <a>Gillmor, D.</a> and <a>T. Reddy</a>, "<a href="https://tools.ietf.org/html/rfc8310">Usage Profiles for DNS over TLS and DNS over DTLS</a>", RFC 8310, DOI 10.17487/RFC8310, March 2018.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Tirumaleswar Reddy</span> 
	  <span class="n hidden">
		<span class="family-name">Reddy</span>
	  </span>
	</span>
	<span class="org vcardline">McAfee, Inc.</span>
	<span class="adr">
	  <span class="vcardline">Embassy Golf Link Business Park</span>

	  <span class="vcardline">
		<span class="locality">Bangalore</span>,  
		<span class="region">Karnataka</span> 
		<span class="code">560071</span>
	  </span>
	  <span class="country-name vcardline">India</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:TirumaleswarReddy_Konda@McAfee.com">TirumaleswarReddy_Konda@McAfee.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Dan Wing</span> 
	  <span class="n hidden">
		<span class="family-name">Wing</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:dan@danwing.org">dan@danwing.org</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Michael C. Richardson</span> 
	  <span class="n hidden">
		<span class="family-name">Richardson</span>
	  </span>
	</span>
	<span class="org vcardline">Sandelman Software Works</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:mcr+ietf@sandelman.ca">mcr+ietf@sandelman.ca</a></span>

  </address>
</div>

</body>
</html>
